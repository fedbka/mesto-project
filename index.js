(()=>{"use strict";function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var n=function(e){e.setAttribute("novalidation",!0),e.addEventListener("submit",(function(e){return e.preventDefault()}))},r=function(e,t){e.validity.valid?t.textContent="":(e.setCustomValidity(e.validity.patternMismatch?e.dataset.errorMessage:""),t.textContent=e.validationMessage)},o=function(e,t){i(e)?t.setAttribute("disabled",!0):t.removeAttribute("disabled",!1)},i=function(e){return e.some((function(e){return!e.validity.valid}))},u={baseUrl:"https://nomoreparties.co/v1/".concat("plus-cohort-15"),headers:{authorization:"1eb95489-35af-40e1-aa20-3c2a6c828418","Content-Type":"application/json"}},c=function(e){return Promise.reject("Что-то пошло не так: ".concat(e.status))},a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r={method:t,headers:u.headers};return"GET"!=t&&n&&(r.body=JSON.stringify(n)),fetch("".concat(u.baseUrl,"/").concat(e),r).then((function(e){if(e.ok)return e.json();c(e)}))};function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d={name:"",about:"",avatar:"",_id:"",cohort:""};function m(e){d=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e)}function f(e,t){return e._id===t._id}var p=document.querySelector(".profile__user-name"),v=document.querySelector(".profile__user-description"),y=document.querySelector(".profile__avatar");function b(){p.textContent=d.name,v.textContent=d.about,y.setAttribute("src",d.avatar)}var _="popup_opened";function h(e){e.classList.remove(_),document.removeEventListener("keydown",g)}function S(e){e.classList.add(_),document.addEventListener("keydown",g)}function g(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&h(t)}}function E(e){e.textContent="Сохранение..."}function q(e){e.textContent="Сохранить"}var k=document.querySelector(".showroom__image"),A=document.querySelector(".showroom__caption"),L=document.querySelector(".popup_with-image"),O=document.forms.userProfile,w=O.querySelector(".form__submit-button");O.addEventListener("submit",(function(){var e,t;E(w),(e=O.elements.username.value,t=O.elements.userDescription.value,a("users/me","PATCH",{name:e,about:t})).then((function(e){m(e),b(),h(j),q(w)})).catch((function(e){q(w),console.log(e),h(j),O.reset()}))}));var j=document.querySelector(".popup_profile-edit"),C=document.forms.newCard,P=C.querySelector(".form__submit-button"),T=document.querySelector(".popup_add-element");C.addEventListener("submit",(function(){var e,t;E(P),(e=C.elements.elementName.value,t=C.elements.elementImageUrl.value,a("cards/","POST",{name:e,link:t})).then((function(e){N.unshift(e),$(H(e),!0),h(T),C.reset(),q(P)})).catch((function(e){q(P),console.log(e),h(T),C.reset()}))}));var x=document.forms.updateAvatar,D=x.querySelector(".form__submit-button"),I=document.querySelector(".popup_avatar-edit");x.addEventListener("submit",(function(){var e;E(D),(e=x.elements.avatarImageUrl.value,a("users/me/avatar","PATCH",{avatar:e})).then((function(e){m(e),b(),h(I),x.reset(),q(D)})).catch((function(e){q(D),console.log(e),h(I),x.reset()}))}));var U,M,N=[],B=document.querySelector(".elements"),G=document.querySelector("#element__template"),H=function(e){var t=G.content.cloneNode(!0),n=t.querySelector(".element__image");n.setAttribute("src",e.link),n.setAttribute("alt",e.name),n.addEventListener("click",(function(){return t=e.name,n=e.link,k.setAttribute("src",n),k.setAttribute("alt",t),A.textContent=t,void S(L);var t,n})),t.querySelector(".element__title").textContent=e.name;var r=t.querySelector(".element__like-button");e.likes.some((function(e){return f(e,d)}))&&r.classList.add("element__like-button_liked");var o=t.querySelector(".element__likes-count");o.textContent=e.likes.length,r.addEventListener("click",(function(){var t;(r.classList.contains("element__like-button_liked")?(t=e._id,a("cards/likes/".concat(t),"DELETE")):function(e){return a("cards/likes/".concat(e),"PUT")}(e._id)).then((function(e){return o.textContent=e.likes.length})),r.classList.toggle("element__like-button_liked")}));var i=t.querySelector(".element__delete-button");if(f(e.owner,d)){var u=t.querySelector(".element");i.addEventListener("click",(function(){var t;(t=e._id,a("cards/".concat(t),"DELETE")).then(u.remove())}))}else i.classList.add("element__like-button_hidden");return t},$=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t?B.prepend(e):B.append(e)};function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}a("users/me").then((function(e){m(e),b()})).catch().then((N.splice(0,N.length),void a("cards").then((function(e){return e.forEach((function(e){N.push(e),$(H(e),!1)}))})).catch((function(e){return console.log(e)})))),U={formSelector:".form",inputSelector:".form__item",inputErrorSelector:"form__input-error",submitButtonSelector:".form__submit-button"},e(document.querySelectorAll(U.formSelector)).forEach((function(t){return function(t,i){n(t);var u=t.querySelector(i.submitButtonSelector),c=e(t.querySelectorAll(i.inputSelector)),a=new Map;c.forEach((function(e){var n=t.querySelector(".".concat(e.id,"-error"));a.set(e,n)})),o(c,u),c.forEach((function(e){return e.addEventListener("input",(function(){r(e,a.get(e)),o(c,u)}))})),t.addEventListener("reset",(function(){o(c,u)}))}(t,U)})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){O.reset(),O.elements.username.value=d.name,O.elements.userDescription.value=d.about,S(j)})),document.querySelector(".profile__add-photo-button").addEventListener("click",(function(){C.reset(),S(T)})),document.querySelector(".profile__avatar").addEventListener("click",(function(){x.elements.avatarImageUrl.value=d.avatar,S(I)})),(function(e){if(Array.isArray(e))return z(e)}(M=document.querySelectorAll(".popup"))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(M)||function(e,t){if(e){if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,t):void 0}}(M)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).forEach((function(e){return e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close-button"))&&h(e)}))}))})();